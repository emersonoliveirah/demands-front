<div class="manager-dashboard">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Dashboard do Manager</h1>
    <p class="subtitle">Visão geral das demandas e equipe</p>
  </div>

  <!-- Cards de Estatísticas (preparado para gráficos futuros) -->
  <div class="stats-grid" *ngIf="!loadingSubordinates && !errorLoadingSubordinates">
    <div class="stat-card">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#0057B7"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3>{{ getTotalSubordinates() }}</h3>
        <p>Subordinados</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" fill="#0057B7"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3>{{ getTotalDemands() }}</h3>
        <p>Total de Demandas</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3.5 6L12 10.5 8.5 8 12 5.5 15.5 8zM8.5 16L12 13.5 15.5 16 12 18.5 8.5 16zm7-4L12 12l-3.5 0L12 10l3.5 2z" fill="#0057B7"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3>{{ getActiveDemands() }}</h3>
        <p>Demandas Ativas</p>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="#0057B7"/>
        </svg>
      </div>
      <div class="stat-content">
        <h3>{{ getCompletedDemands() }}</h3>
        <p>Concluídas</p>
      </div>
    </div>
  </div>

  <!-- Área para Gráficos Futuros -->
  <div class="charts-section" *ngIf="!loadingSubordinates && !errorLoadingSubordinates">
    <div class="chart-placeholder">
      <div class="placeholder-content">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" fill="#0057B7" opacity="0.3"/>
        </svg>
        <p>Área reservada para gráficos</p>
        <span>Adicione visualizações de dados aqui no futuro</span>
      </div>
    </div>
  </div>

  <!-- Indicador de Carregamento dos Subordinados -->
  <div *ngIf="loadingSubordinates" class="loading">
    <div class="loader"></div>
    <p>Carregando subordinados...</p>
  </div>

  <!-- Mensagem de Erro no Carregamento dos Subordinados -->
  <div *ngIf="errorLoadingSubordinates && !loadingSubordinates" class="error">
    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" fill="#ff5252"/>
    </svg>
    <p>Erro: {{ errorLoadingSubordinates }}</p>
    <button (click)="loadSubordinates()">Tentar Novamente</button>
  </div>

  <!-- Conteúdo Principal -->
  <div *ngIf="!loadingSubordinates && !errorLoadingSubordinates" class="main-content">
    <div class="section-header">
      <h2>Seus Subordinados Diretos</h2>
      <span class="badge">{{ subordinatesWithState?.length || 0 }}</span>
    </div>

    <div *ngIf="subordinatesWithState && subordinatesWithState.length > 0; else noSubordinates" class="subordinates-grid">
      <div *ngFor="let subordinate of subordinatesWithState" class="subordinate-card">
        <div class="card-header">
          <div class="user-info">
            <div class="user-avatar">
              {{ subordinate.name?.charAt(0)?.toUpperCase() || 'U' }}
            </div>
            <div>
              <h3>{{ subordinate.name }}</h3>
              <p class="user-email">{{ subordinate.email }}</p>
            </div>
          </div>
        </div>

        <div class="card-actions">
          <button
            class="btn-load"
            (click)="loadDemandsForSubordinate(subordinate.id)"
            [disabled]="subordinate.loadingDemands"
            *ngIf="!subordinate.demands && !subordinate.errorLoadingDemands">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" fill="currentColor"/>
            </svg>
            {{ subordinate.loadingDemands ? 'Carregando...' : 'Carregar Demandas' }}
          </button>

          <button
            class="btn-clear"
            (click)="clearDemandsForSubordinate(subordinate.id)"
            *ngIf="subordinate.demands || subordinate.errorLoadingDemands">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
            </svg>
            Limpar
          </button>
        </div>

        <!-- Indicador de Carregamento das Demandas -->
        <div *ngIf="subordinate.loadingDemands" class="loading-state">
          <div class="loader-small"></div>
          <p>Carregando demandas...</p>
        </div>

        <!-- Mensagem de Erro no Carregamento das Demandas -->
        <div *ngIf="subordinate.errorLoadingDemands && !subordinate.loadingDemands" class="error-state">
          <p>{{ subordinate.errorLoadingDemands }}</p>
          <button class="btn-retry" (click)="reloadDemandsForSubordinate(subordinate.id)">Tentar Novamente</button>
        </div>

        <!-- Exibição das Demandas -->
        <div *ngIf="subordinate.demands && !subordinate.loadingDemands && !subordinate.errorLoadingDemands" class="demands-list">
          <div class="demands-header">
            <h4>Demandas ({{ subordinate.demands.length }})</h4>
          </div>
          <div *ngIf="subordinate.demands.length > 0; else noDemandsForSubordinate" class="demands-items">
            <div *ngFor="let demand of subordinate.demands" class="demand-item">
              <div class="demand-main">
                <strong>{{ demand.title }}</strong>
                <span class="status-badge" [ngClass]="demand.status?.toLowerCase()">
                  {{ demand.status || 'OPEN' }}
                </span>
              </div>
              <p class="demand-description">{{ demand.description || 'Sem descrição' }}</p>
              <div class="demand-meta">
                <span *ngIf="demand.type" class="demand-type">{{ demand.type }}</span>
                <span *ngIf="demand.startDate" class="demand-date">
                  {{ demand.startDate | date:'dd/MM/yyyy' }}
                </span>
              </div>
            </div>
          </div>
          <ng-template #noDemandsForSubordinate>
            <div class="empty-state">
              <p>{{ subordinate.name }} não possui demandas.</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <ng-template #noSubordinates>
      <div class="empty-state-large">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" fill="#0057B7" opacity="0.3"/>
        </svg>
        <p>Você não tem subordinados diretos.</p>
      </div>
    </ng-template>
  </div>
</div>
